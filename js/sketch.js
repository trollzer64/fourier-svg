let time = 0;
let time_scale = 100 / 100;
let path = [];
let scaled_radius = 0.5;

let y = [];
let x = [];

function setup() {
  createCanvas(1000, 600);

  y = [
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    131.137,
    128.7810435,
    118.7705656,
    108.7654834,
    98.7714615,
    88.77534224,
    78.78098987,
    68.78461317,
    58.93811671,
    49.39866373,
    40.32387239,
    31.89187008,
    24.21243431,
    17.44372416,
    11.67984774,
    7.037562233,
    3.592336448,
    1.415074476,
    0.541442742,
    0.966442445,
    2.695050504,
    5.703693384,
    9.938656586,
    15.32805386,
    21.762664,
    29.14156456,
    37.33308113,
    46.19291984,
    55.59665947,
    65.36220906,
    75.31681216,
    85.29502321,
    95.0934623,
    104.5499792,
    113.4946719,
    121.8033767,
    129.3763132,
    136.0722987,
    141.8198069,
    146.4816121,
    149.9524964,
    152.1238446,
    152.9044726,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    152.906,
    158.9269676,
    168.1920282,
    177.4416979,
    186.6964332,
    195.9474393,
    205.2044298,
    214.4693575,
    223.7159732,
    232.9811483,
    242.2349056,
    251.481567,
    260.7355679,
    269.9961188,
    279.2625995,
    288.5112728,
    297.7692073,
    307.0289473,
    316.2792217,
    325.5250994,
    334.7877866,
    344.0407931,
    353.2884953,
    362.5595086,
    370.598,
    370.598,
    370.598,
    370.598,
    370.598,
    370.598,
    370.598,
    370.598,
    370.598,
    370.598,
    370.598,
    370.598,
    370.598,
    370.598,
    370.598,
    370.598,
    370.598,
    368.1181377,
    358.1122645,
    348.1085577,
    338.1148518,
    328.1183583,
    318.1119434,
    308.1257893,
    298.2700469,
    288.7376208,
    279.6838064,
    271.2488256,
    263.5906918,
    256.8238642,
    251.0734487,
    246.4457746,
    243.0162602,
    240.8579304,
    239.9994711,
    240.4404905,
    242.1841602,
    245.2123528,
    249.462299,
    254.8655578,
    261.3227212,
    268.7030974,
    276.8924109,
    285.7733233,
    295.1704341,
    304.9414611,
    314.9004037,
    324.8869508,
    334.6807157,
    344.1310992,
    353.0682163,
    361.3679111,
    368.9200526,
    375.6145097,
    381.3411515,
    385.9957398,
    389.4504644,
    391.6021521,
    392.3662305,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    392.367,
    386.7595796,
    377.5026215,
    368.2593486,
    359.0000901,
    349.7416099,
    340.483104,
    331.2335639,
    321.9755266,
    312.7255105,
    303.4707465,
    294.2118991,
    284.9603078,
    275.6954704,
    266.4387044,
    257.1848105,
    247.9275086,
    238.6851699,
    229.431603,
    220.17006,
    210.9118254,
    201.6574831,
    192.4044526,
    183.138155,
    173.8900392,
    164.636915,
    155.3759652,
    146.1201171,
    136.8668176
  ]
  x = [
    106.8679446,
    116.8659567,
    126.8671165,
    136.8604815,
    146.8737069,
    156.8649909,
    166.8635411,
    176.861917,
    186.8612355,
    196.8615626,
    206.8667725,
    216.8744423,
    226.8688836,
    236.8638631,
    246.8642781,
    256.8744938,
    266.8721674,
    276.8747247,
    286.8653447,
    296.8649998,
    306.8652292,
    316.8736254,
    326.8687182,
    336.8709985,
    346.8715018,
    356.863276,
    364.504,
    364.504,
    364.504,
    364.504,
    364.504,
    364.504,
    364.9135063,
    366.5971895,
    369.564812,
    373.7683114,
    379.1153143,
    385.5274057,
    392.8672724,
    401.032918,
    409.8702581,
    419.2548282,
    429.0193186,
    438.9619256,
    448.9545973,
    458.8012365,
    468.3226125,
    477.3633922,
    485.7833239,
    493.4244366,
    500.1722717,
    505.9017979,
    510.5067938,
    513.9119091,
    516.0443568,
    516.8753838,
    516.3579205,
    514.4418947,
    511.202883,
    506.7524759,
    501.2048094,
    494.6601336,
    487.2591728,
    479.0696044,
    470.2357182,
    460.87049,
    451.1148581,
    441.1564484,
    431.150208,
    421.1546215,
    411.153758,
    401.1588013,
    391.1487912,
    381.1467116,
    371.1547516,
    361.1606143,
    351.1493984,
    341.1447649,
    331.1560262,
    321.1606857,
    311.1533943,
    301.1505146,
    291.1491888,
    281.1536905,
    271.1593168,
    261.1614414,
    251.1495473,
    241.149123,
    231.1545001,
    221.1610068,
    211.1538367,
    201.1472548,
    195.2018165,
    191.4114716,
    187.6274232,
    183.8413023,
    180.0567071,
    176.2696637,
    172.4793731,
    168.696574,
    164.9061822,
    161.1204615,
    157.3376437,
    153.5518233,
    149.7633233,
    145.9723974,
    142.1887566,
    138.4013269,
    134.6131587,
    130.8288628,
    127.0463656,
    123.2569917,
    119.4715781,
    115.6883345,
    111.8955543,
    109.9169265,
    119.9129835,
    129.9240045,
    139.9157682,
    149.9185216,
    159.9174655,
    169.9129984,
    179.9113146,
    189.910981,
    199.9189452,
    209.9163444,
    219.9188203,
    229.9238396,
    239.9079684,
    249.9156499,
    259.9171745,
    269.9140217,
    277.427,
    277.427,
    277.427,
    277.427,
    277.427,
    277.427,
    277.8490467,
    279.5512676,
    282.534954,
    286.7465792,
    292.1143827,
    298.529301,
    305.8904523,
    314.0662341,
    322.9123907,
    332.3044745,
    342.0604091,
    352.0227001,
    361.9972684,
    371.838775,
    381.3673966,
    390.3997983,
    398.8100276,
    406.4504395,
    413.1757073,
    418.8843029,
    423.4820737,
    426.8673883,
    428.984999,
    429.8005019,
    429.264604,
    427.3308658,
    424.0754407,
    419.6100328,
    414.048803,
    407.50212,
    400.0803525,
    391.8938691,
    383.0398237,
    373.6682301,
    363.9221509,
    353.9458144,
    343.9541113,
    333.9446113,
    323.9452621,
    313.955639,
    303.9492124,
    293.9573254,
    283.9531497,
    273.9569453,
    263.9574512,
    253.9544382,
    243.9420601,
    233.9459743,
    223.9522897,
    213.9546066,
    203.9410434,
    193.9441963,
    183.9464164,
    173.9444429,
    163.9506223,
    153.9452209,
    143.9578679,
    133.9560069,
    123.9581819,
    113.9556723,
    103.9463206,
    93.95091087,
    83.94285213,
    73.94171065,
    63.94811186,
    53.94757724,
    43.94866551,
    33.9465712,
    23.95837287,
    13.94393482,
    3.941011105,
    2.293905678,
    6.08077866,
    9.862053223,
    13.64986725,
    17.43736292,
    21.22486905,
    25.00870748,
    28.79602191,
    32.58005501,
    36.36603045,
    40.1536763,
    43.93835381,
    47.72845006,
    51.51524445,
    55.30086393,
    59.08787752,
    62.86876994,
    66.65425562,
    70.44300422,
    74.2303994,
    78.01620228,
    81.80146855,
    85.59216218,
    89.37541788,
    93.16072247,
    96.94922842,
    100.7356473,
    104.5210236,
  ]

  fourierY = dft(y);
  fourierX = dft(x);
}

function epiCycles(x, y, rotation, fourier) {
  for (let i = 0; i < fourier.length; i++) {
    let prevx = x;
    let prevy = y;
    // render circle
    let radius = scaled_radius * fourier[i].amplitude;
    let ang_vel = fourier[i].frequency;
    let ang_pos = fourier[i].phase;
    stroke(255, 50);
    noFill();
    ellipse(x, y, radius * 2);
    // Set the actual position on the circle
    x += radius * cos(ang_vel * time + ang_pos + rotation);
    // y in web is down-wise
    y += -radius * sin(ang_vel * time + ang_pos + rotation);
    // Render cos and sin pos
    stroke('#ff0000');
    fill('#ff0000')
    line(prevx, prevy, x, y);
  }
  return createVector(x, y);
}

function draw() {
  const time_dt = time_scale * TWO_PI / fourierY.length;
  background('#000000');
  // translate(200, 200);
  let x = 0;
  let y = 0;

  let vx = epiCycles(500, 50, 0, fourierX);
  let vy = epiCycles(100, 300, HALF_PI, fourierY);

  let v = createVector(vx.x, vy.y);
  path.unshift(v);
  line(vx.x, vx.y, v.x, v.y);
  line(vy.x, vy.y, v.x, v.y);
  beginShape();
  stroke(255, 100);
  noFill();
  for (let i = 0; i < path.length; i++) {
    vertex(path[i].x, path[i].y);
  }
  endShape();

  time += time_dt;

}
